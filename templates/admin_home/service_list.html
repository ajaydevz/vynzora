



{% extends "admin_home/base.html" %}
{% load static %}

{% block content %}

<style>
  /* Copy all your existing styles here - I'm keeping them as-is */
  /* Only showing the essential parts below */
  
  .service-list-container {
    max-width: 1400px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .header-left h2 {
    font-size: 28px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 8px;
  }

  .header-left p {
    color: #6c757d;
    font-size: 14px;
    margin: 0;
  }

  .header-right {
    display: flex;
    gap: 15px;
    align-items: center;
  }

  .search-box {
    position: relative;
    width: 300px;
  }

  .search-box input {
    width: 100%;
    padding: 12px 45px 12px 45px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.3s ease;
    background: #f8f9fa;
  }

  .search-box input:focus {
    outline: none;
    border-color: #3498db;
    background: #fff;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
  }

  .search-box i {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    font-size: 18px;
  }

  .clear-search {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    font-size: 18px;
    display: none;
    transition: color 0.3s ease;
  }

  .clear-search:hover {
    color: #e74c3c;
  }

  .clear-search.show {
    display: block;
  }

  .btn-add {
    padding: 12px 24px;
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
  }

  .btn-add:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
  }

  .service-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }

  .service-card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 25px 30px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .service-card-header h3 {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .service-count {
    background: rgba(255, 255, 255, 0.2);
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
  }

  .table-wrapper {
    overflow-x: auto;
    max-height: 600px;
    overflow-y: auto;
  }

  .service-table {
    width: 100%;
    border-collapse: collapse;
  }

  .service-table thead {
    background: #f8f9fa;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .service-table thead th {
    padding: 18px 20px;
    text-align: left;
    font-size: 13px;
    font-weight: 700;
    color: #2c3e50;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e9ecef;
  }

  .service-table tbody tr {
    border-bottom: 1px solid #f1f3f5;
    transition: all 0.3s ease;
  }

  .service-table tbody tr:hover {
    background: #f8f9fa;
    transform: scale(1.01);
  }

  .service-table tbody td {
    padding: 20px;
    font-size: 14px;
    color: #495057;
  }

  .service-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .service-image {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    object-fit: cover;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .service-details h4 {
    font-size: 15px;
    font-weight: 600;
    color: #2c3e50;
    margin: 0 0 6px 0;
  }

  .service-details p {
    font-size: 13px;
    color: #6c757d;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 400px;
  }

  .no-image {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 32px;
    font-weight: 700;
  }

  .service-meta {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .meta-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: #e3f2fd;
    color: #1976d2;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .meta-badge i {
    font-size: 14px;
  }

  .meta-badge.offers {
    background: #f3e5f5;
    color: #7b1fa2;
  }

  .meta-badge.steps {
    background: #e8f5e9;
    color: #388e3c;
  }

  .meta-badge.faqs {
    background: #fff3e0;
    color: #f57c00;
  }

  .action-buttons {
    display: flex;
    gap: 10px;
  }

  .btn-action {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
  }

  .btn-update {
    background: #3498db;
    color: white;
  }

  .btn-update:hover {
    background: #2980b9;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
  }

  .btn-delete {
    background: #e74c3c;
    color: white;
  }

  .btn-delete:hover {
    background: #c0392b;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
  }

  .empty-state {
    text-align: center;
    padding: 80px 20px;
  }

  .empty-state i {
    font-size: 64px;
    color: #cbd5e0;
    margin-bottom: 20px;
  }

  .empty-state h3 {
    font-size: 20px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 10px;
  }

  .empty-state p {
    font-size: 14px;
    color: #6c757d;
    margin-bottom: 25px;
  }

  .no-results {
    text-align: center;
    padding: 60px 20px;
  }

  .no-results i {
    font-size: 48px;
    color: #cbd5e0;
    margin-bottom: 15px;
  }

  .no-results p {
    font-size: 14px;
    color: #6c757d;
  }

  .highlight {
    background: #fff3cd;
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 600;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    animation: fadeIn 0.3s ease;
  }

  .modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Modal Content - Prevent content from overlapping header */
.modal-content {
  background: #fff;
  border-radius: 16px;
  max-width: 800px;
  width: 90%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.3s ease;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Changed from overflow-y: auto */
}

/* Modal Header - Keep it sticky at the top */
.modal-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 25px 30px;
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 16px 16px 0 0;
  position: sticky;
  top: 0;
  z-index: 100; /* Increased z-index */
  flex-shrink: 0; /* Prevent header from shrinking */
}

/* Modal Body - Make this scrollable instead */
.modal-body {
  padding: 30px;
  overflow-y: auto;
  overflow-x: hidden;
  flex: 1;
  position: relative;
  z-index: 1; /* Lower than header */
}

/* CKEditor specific fixes */
.ck.ck-editor {
  position: relative;
  z-index: 1; /* Ensure it stays below the header */
}

.ck.ck-editor__main {
  position: relative;
  z-index: 1;
}

.ck.ck-toolbar {
  position: relative;
  z-index: 1;
}

/* Ensure modal body scrollbar styling */
.modal-body::-webkit-scrollbar {
  width: 8px;
}

.modal-body::-webkit-scrollbar-track {
  background: #f1f3f5;
  border-radius: 10px;
}

.modal-body::-webkit-scrollbar-thumb {
  background: #cbd5e0;
  border-radius: 10px;
}

.modal-body::-webkit-scrollbar-thumb:hover {
  background: #a0aec0;
}

/* Delete Modal - Apply same fix */
.modal-content.delete-modal-content {
  background: #fff;
  max-width: 550px;
  width: 95%;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
  overflow: hidden;
  animation: slideUp 0.3s ease;
  display: flex;
  flex-direction: column;
}

.delete-modal-body {
  padding: 30px;
  overflow-y: auto;
  flex: 1;
}

  .modal-header h3 {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .modal-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .modal-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
  }

 

  /* Form Styles */
  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
    font-size: 14px;
  }

  .required {
    color: #e74c3c;
  }

  .form-control {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.3s ease;
    box-sizing: border-box;
  }

  .form-control:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
  }

  textarea.form-control {
    min-height: 120px;
    resize: vertical;
  }

  .character-count {
    font-size: 12px;
    color: #6c757d;
    margin-top: 6px;
    text-align: right;
  }

  .character-count.warning {
    color: #f39c12;
  }

  .character-count.error {
    color: #e74c3c;
  }

  /* Image Upload Styles */
  .current-image-wrapper {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    display: none;
  }

  .current-image-wrapper h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: #2c3e50;
  }

  .current-image {
    max-width: 150px;
    max-height: 150px;
    border-radius: 8px;
    object-fit: cover;
  }

  .image-actions {
    margin-top: 10px;
  }

  .btn-clear-image {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
  }

  .btn-clear-image:hover {
    background: #c0392b;
  }

  .file-input-wrapper {
    position: relative;
  }

  .file-input-wrapper input[type="file"] {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
  }

  .file-input-custom {
    padding: 20px;
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    text-align: center;
    background: #f8f9fa;
    transition: all 0.3s ease;
  }

  .file-input-wrapper:hover .file-input-custom {
    border-color: #3498db;
    background: #e3f2fd;
  }

  .file-input-custom i {
    font-size: 32px;
    color: #6c757d;
    margin-bottom: 10px;
  }

  .file-input-custom small {
    color: #6c757d;
  }

  /* Modal Actions */
  .modal-actions {
    display: flex;
    gap: 12px;
    margin-top: 30px;
  }

  .btn-modal {
    flex: 1;
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn-cancel {
    background: #e9ecef;
    color: #495057;
  }

  .btn-cancel:hover {
    background: #dee2e6;
  }

  .btn-submit {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
  }

  .btn-confirm-delete {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
  }

  .btn-confirm-delete:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
  }

  /* Delete Modal Styles */
  .delete-warning {
    text-align: center;
    padding: 20px;
  }

  .delete-warning i {
    font-size: 64px;
    color: #e74c3c;
    margin-bottom: 20px;
  }

  .delete-warning h4 {
    font-size: 20px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 10px;
  }

  .delete-warning p {
    font-size: 14px;
    color: #6c757d;
    margin-bottom: 10px;
  }

  .delete-service-name {
    font-weight: 700;
    color: #e74c3c;
    font-size: 18px;
  }

  /* Tab Styles */
  .modal-tabs {
    display: flex;
    border-bottom: 2px solid #e9ecef;
    margin-bottom: 20px;
  }

  .tab-button {
    padding: 12px 20px;
    background: none;
    border: none;
    font-size: 14px;
    font-weight: 600;
    color: #6c757d;
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
  }

  .tab-button:hover {
    color: #3498db;
  }

  .tab-button.active {
    color: #3498db;
    border-bottom-color: #3498db;
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  .tab-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .tab-header h4 {
    margin: 0;
    color: #2c3e50;
    font-size: 16px;
  }

  .btn-add-small {
    padding: 8px 16px;
    background: linear-gradient(135deg, #27ae60, #219653);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn-add-small:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
  }

  /* Formset Styles */
  .formset-container {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
  }

  .formset-item {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    border: 2px solid #e9ecef;
    position: relative;
    transition: all 0.3s ease;
  }

  .formset-item:hover {
    border-color: #3498db;
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.1);
  }

  .formset-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f1f3f5;
  }

  .formset-title {
    font-size: 15px;
    font-weight: 600;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .formset-number {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 700;
  }

  .btn-remove-formset {
    padding: 6px 14px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn-remove-formset:hover {
    background: #c0392b;
    transform: translateY(-1px);
  }

  .btn-add-formset {
    padding: 10px 20px;
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
  }

  .btn-add-formset:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(46, 204, 113, 0.3);
  }

  .formset-limit-text {
    font-size: 12px;
    color: #6c757d;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .help-text {
    font-size: 12px;
    color: #6c757d;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .help-text i {
    font-size: 14px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
      align-items: stretch;
    }

    .header-right {
      flex-direction: column;
    }

    .search-box {
      width: 100%;
    }

    .service-table thead th,
    .service-table tbody td {
      padding: 12px;
      font-size: 12px;
    }

    .service-info {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .service-image,
    .no-image {
      width: 60px;
      height: 60px;
    }

    .service-details p {
      max-width: 100%;
    }

    .action-buttons {
      flex-direction: column;
      width: 100%;
    }

    .btn-action {
      width: 100%;
      justify-content: center;
    }

    .modal-content {
      width: 95%;
      margin: 10px;
    }

    .modal-actions {
      flex-direction: column;
    }

    .btn-modal {
      width: 100%;
    }

    .modal-tabs {
      flex-wrap: wrap;
    }
    
    .tab-button {
      flex: 1;
      min-width: 120px;
      text-align: center;
    }
  }

  /* Scrollbar Styling */
  .table-wrapper::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .table-wrapper::-webkit-scrollbar-track {
    background: #f1f3f5;
    border-radius: 10px;
  }

  .table-wrapper::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 10px;
  }

  .table-wrapper::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
  }

  .modal-content::-webkit-scrollbar {
    width: 8px;
  }

  .modal-content::-webkit-scrollbar-track {
    background: #f1f3f5;
    border-radius: 10px;
  }

  .modal-content::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 10px;
  }

  .modal-content::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
  }

  
  .service-list-container {
    max-width: 1400px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ... all your other styles ... */
  
  .formset-item {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    border: 2px solid #e9ecef;
    position: relative;
    transition: all 0.3s ease;
  }
  
  .formset-item.marked-for-deletion {
    opacity: 0.5;
    background: #ffe6e6;
  }
  
  /* Add all remaining styles from your original template */
</style>

<div class="service-list-container">
  <!-- Alert Messages -->
  <div id="alertMessage" class="alert-message"></div>

  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h2>Services</h2>
      <p>Manage your services and their information</p>
    </div>
    <div class="header-right">
      <div class="search-box">
        <i class="mdi mdi-magnify"></i>
        <input type="text" id="searchInput" placeholder="Search by service name..." autocomplete="off">
        <button type="button" class="clear-search" id="clearSearch">
          <i class="mdi mdi-close"></i>
        </button>
      </div>
      <a href="{% url 'service_add' %}" class="btn-add">
        <i class="mdi mdi-plus"></i>
        Add Service
      </a>
    </div>
  </div>

  <!-- Service Card -->
  <div class="service-card">
    <div class="service-card-header">
      <h3>
        <i class="mdi mdi-briefcase-outline"></i>
        All Services
      </h3>
      <span class="service-count" id="serviceCount">{{ services|length }} Services</span>
    </div>

    <div class="table-wrapper">
      {% if services %}
      <table class="service-table">
        <thead>
          <tr>
            <th>Service</th>
            <th>Details</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="serviceTableBody">
          {% for service in services %}
          <tr data-name="{{ service.name }}" data-description="{{ service.description }}" id="service-row-{{ service.id }}">
            <td>
              <div class="service-info">
                {% if service.image %}
                  <img src="{{ service.image.url }}" alt="{{ service.name }}" class="service-image" id="service-image-{{ service.id }}">
                {% else %}
                  <div class="no-image">{{ service.name|first|upper }}</div>
                {% endif %}
                <div class="service-details">
                  <h4 class="service-name" id="service-name-{{ service.id }}">{{ service.name }}</h4>
                  <p class="service-description" id="service-description-{{ service.id }}">{{ service.description|safe|truncatewords:20 }}</p>
                </div>
              </div>
            </td>
            <td>
              <div class="service-meta">
                <span class="meta-badge offers">
                  <i class="mdi mdi-star-circle"></i>
                  <span id="offers-count-{{ service.id }}">{{ service.offers.count }}</span> Offers
                </span>
                <span class="meta-badge steps">
                  <i class="mdi mdi-list-status"></i>
                  <span id="steps-count-{{ service.id }}">{{ service.process_steps.count }}</span> Steps
                </span>
                <span class="meta-badge faqs">
                  <i class="mdi mdi-help-circle"></i>
                  <span id="faqs-count-{{ service.id }}">{{ service.faqs.count }}</span> FAQs
                </span>
              </div>
            </td>
            <td>
              <div class="action-buttons">
                <button type="button" class="btn-action btn-update" onclick="openUpdateModal({{ service.pk }})">
                  <i class="mdi mdi-pencil"></i>
                  Update
                </button>
                <button type="button" class="btn-action btn-delete" onclick="openDeleteModal({{ service.pk }}, '{{ service.name|escapejs }}')">
                  <i class="mdi mdi-delete"></i>
                  Delete
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="no-results" id="noResults" style="display: none;">
    <i class="mdi mdi-magnify"></i>
    <p>No services found matching your search.</p>
</div>
      {% else %}
      <div class="empty-state">
        <i class="mdi mdi-briefcase-off"></i>
        <h3>No Services Yet</h3>
        <p>Start by adding your first service</p>
        {% comment %} <a href="{% url 'service_add' %}" class="btn-add">
          <i class="mdi mdi-plus"></i>
          Add First Service
        </a> {% endcomment %}
      </div>
      {% endif %}
    </div>
  </div>
</div>




<script>
// Search functionality for services page - Exact same structure as reference
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');
    const serviceTableBody = document.getElementById('serviceTableBody');
    const noResults = document.getElementById('noResults');
    const serviceCount = document.getElementById('serviceCount');

    // Highlight text function
    function highlightText(text, searchTerm) {
        if (!searchTerm) return text;
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, `<span class="highlight">$1</span>`);
    }

    // Remove highlighting
    function removeHighlighting() {
        const highlightedElements = document.querySelectorAll('.highlight');
        highlightedElements.forEach(el => {
            const parent = el.parentNode;
            parent.replaceChild(document.createTextNode(el.textContent), el);
            parent.normalize();
        });
    }

    // Search functionality
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            
            if (searchTerm) {
                clearSearch.classList.add('show');
            } else {
                clearSearch.classList.remove('show');
                removeHighlighting();
            }

            const rows = serviceTableBody.getElementsByTagName('tr');
            let visibleCount = 0;

            Array.from(rows).forEach(row => {
                const name = row.getAttribute('data-name')?.toLowerCase() || '';
                const description = row.getAttribute('data-description')?.toLowerCase() || '';
                
                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                    
                    // Highlight matching text in name
                    const nameElement = row.querySelector('.service-name');
                    if (nameElement && name.includes(searchTerm)) {
                        nameElement.innerHTML = highlightText(row.getAttribute('data-name'), searchTerm);
                    } else if (nameElement) {
                        nameElement.textContent = row.getAttribute('data-name');
                    }
                    
                    // Highlight matching text in description
                    const descElement = row.querySelector('.service-description');
                    if (descElement && description.includes(searchTerm)) {
                        const fullDescription = row.getAttribute('data-description');
                        descElement.innerHTML = highlightText(fullDescription, searchTerm);
                    } else if (descElement) {
                        const fullDescription = row.getAttribute('data-description');
                        descElement.textContent = fullDescription.length > 100 ? 
                            fullDescription.substring(0, 100) + '...' : fullDescription;
                    }
                } else {
                    row.style.display = 'none';
                }
            });

            // Show/hide no results message - EXACTLY like reference
            if (visibleCount === 0 && searchTerm) {
                noResults.style.display = 'block';
                serviceTableBody.style.display = 'none';
            } else {
                noResults.style.display = 'none';
                serviceTableBody.style.display = '';
            }

            // Update count
            if (serviceCount) {
                serviceCount.textContent = `${visibleCount} Service${visibleCount !== 1 ? 's' : ''}`;
            }
        });

        // Clear search functionality
        if (clearSearch) {
            clearSearch.addEventListener('click', function() {
                searchInput.value = '';
                searchInput.dispatchEvent(new Event('input'));
                searchInput.focus();
            });
        }

        // Focus search input on page load
        searchInput.focus();
    }
});
</script>

<!-- Update Modal -->
<div id="updateModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>
        <i class="mdi mdi-pencil"></i>
        Update Service
      </h3>
      <button type="button" class="modal-close" onclick="closeUpdateModal()">
        <i class="mdi mdi-close"></i>
      </button>
    </div>
    <div class="modal-body">
      <form method="POST" enctype="multipart/form-data" id="updateForm">
        {% csrf_token %}
        
        <div id="formErrors" class="alert-message alert-error" style="display: none;"></div>
        
        <!-- Tab Navigation -->
        <div class="modal-tabs">
          <button type="button" class="tab-button active" data-tab="service-tab">Service</button>
          <button type="button" class="tab-button" data-tab="offers-tab">Offers</button>
          <button type="button" class="tab-button" data-tab="steps-tab">Process Steps</button>
          <button type="button" class="tab-button" data-tab="faqs-tab">FAQs</button>
        </div>
        
        <!-- Service Tab -->
        <div id="service-tab" class="tab-content active">
          <div class="form-group">
            <label class="form-label">Service Name<span class="required">*</span></label>
            <input type="text" class="form-control" name="name" id="updateName" placeholder="Enter service name" required maxlength="200">
          </div>

          <div class="form-group">
            <label class="form-label">Description<span class="required">*</span></label>
            <textarea class="form-control" name="description" id="updateDescription" placeholder="Enter service description..." required rows="6"></textarea>
          </div>

          <div class="form-group">
    <label class="form-label">Meta Title</label>
    <input type="text" id="updateMetaTitle" name="meta_title" class="form-control" maxlength="70">
    <div class="character-count" id="metaTitleCount">0/70</div>
</div>

<div class="form-group">
    <label class="form-label">Meta Description</label>
    <textarea id="updateMetaDescription" name="meta_description" class="form-control" rows="3" maxlength="160"></textarea>
    <div class="character-count" id="metaDescCount">0/160</div>
</div>

          <div class="current-image-wrapper" id="currentImageWrapper" style="display: none;">
            <h4>Current Image</h4>
            <img src="" alt="Current" class="current-image" id="currentImage">
          </div>

          <div class="form-group">
            <label class="form-label">Upload New Image (Optional)</label>
            <input type="file" class="form-control" name="image" id="imageInput" accept="image/*">
            <small style="color: #6c757d; font-size: 12px; margin-top: 6px; display: block;">
              Leave empty to keep current image
            </small>
          </div>
        </div>
        
        <!-- Offers Tab -->
        <div id="offers-tab" class="tab-content">
          <div class="formset-container">
            <div class="tab-header">
              <h4>Service Offers (Optional)</h4>
              <button type="button" class="btn-add-formset" onclick="addOffer()">
                <i class="mdi mdi-plus"></i>
                Add Offer
              </button>
            </div>
            <div id="offerFormset"></div>
          </div>
        </div>
        
        <!-- Process Steps Tab -->
        <div id="steps-tab" class="tab-content">
          <div class="formset-container">
            <div class="tab-header">
              <h4>Process Steps (4 Required)</h4>
            </div>
            <div id="stepFormset"></div>
            <p style="font-size: 12px; color: #6c757d; margin-top: 10px;">
              <i class="mdi mdi-information"></i>
              All 4 process steps must be filled
            </p>
          </div>
        </div>
        
        <!-- FAQs Tab -->
        <div id="faqs-tab" class="tab-content">
          <div class="formset-container">
            <div class="tab-header">
              <h4>FAQs (Optional, Max 10)</h4>
              <button type="button" class="btn-add-formset" id="addFaqBtn" onclick="addFaq()">
                <i class="mdi mdi-plus"></i>
                Add FAQ
              </button>
            </div>
            <div id="faqFormset"></div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-modal btn-cancel" onclick="closeUpdateModal()">
            <i class="mdi mdi-close"></i>
            Cancel
          </button>
          <button type="submit" class="btn-modal btn-submit">
            <i class="mdi mdi-check"></i>
            Update Service
          </button>
        </div>
      </form>
    </div>
  </div>
</div>




<!-- Delete Modal -->
{% comment %} <div id="deleteModal" class="modal">
  <div class="modal-content">
    <div class="modal-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
      <h3>
        <i class="mdi mdi-alert"></i>
        Delete Service
      </h3>
      <button type="button" class="modal-close" onclick="closeDeleteModal()">
        <i class="mdi mdi-close"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="delete-warning">
        <i class="mdi mdi-alert-circle-outline"></i>
        <h4>Are you sure?</h4>
        <p>You are about to delete the service</p>
        <p class="delete-service-name" id="deleteServiceName"></p>
        <p style="margin-top: 15px;">This action cannot be undone.</p>
      </div>

      <form method="POST" id="deleteForm">
        {% csrf_token %}
        <div class="modal-actions">
          <button type="button" class="btn-modal btn-cancel" onclick="closeDeleteModal()">
            <i class="mdi mdi-close"></i>
            Cancel
          </button>
          <button type="submit" class="btn-modal btn-confirm-delete">
            <i class="mdi mdi-delete"></i>
            Yes, Delete
          </button>
        </div>
      </form>
    </div>
  </div>
</div> {% endcomment %}

<div id="deleteModal" class="modal">
  <div class="modal-content delete-modal-content">
    <div class="modal-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
      <h3>
        <i class="mdi mdi-delete"></i>
        Delete Service
      </h3>
      <button type="button" class="modal-close" onclick="closeDeleteModal()">
        <i class="mdi mdi-close"></i>
      </button>
    </div>

    <div class="modal-body delete-modal-body">
      <div class="delete-content">
        <div class="delete-icon">
          <i class="mdi mdi-alert-circle-outline"></i>
        </div>
        <div class="delete-text">
          <h4>Are you sure?</h4>
          <p>You are about to delete the service:</p>
          <p class="delete-member-name" id="deleteServiceName"></p>
          <p style="margin-top: 15px;">This action cannot be undone.</p>
        </div>
      </div>

      <form method="POST" id="deleteForm">
        {% csrf_token %}
        <div class="delete-actions">
          <button type="button" class="btn-modal btn-cancel" onclick="closeDeleteModal()">
            <i class="mdi mdi-close"></i>
            Cancel
          </button>
          <button type="submit" class="btn-modal btn-confirm-delete">
            <i class="mdi mdi-delete"></i>
            Yes, Delete
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<style>
  /* ===== Delete Modal (Unified Style) ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  inset: 0;
  background-color: rgba(34, 34, 34, 0.65);
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}

.modal-content.delete-modal-content {
  background: #fff;
 
  max-width: 550px;
  width: 95%;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
  overflow: hidden;
  animation: slideUp 0.3s ease;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  color: #fff;
}

.modal-header h3 {
  font-size: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0;
}

.modal-header .modal-close {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 22px;
  cursor: pointer;
  transition: 0.3s ease;
}

.modal-header .modal-close:hover {
  color: #ffb3b3;
}

/* Body */
.delete-modal-body {
  padding: 30px;
}

.delete-content {
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
  align-items: flex-start;
}

.delete-icon {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
  background: #fee;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.delete-icon i {
  font-size: 26px;
  color: #e74c3c;
}

.delete-text h4 {
  font-size: 18px;
  font-weight: 700;
  color: #2c3e50;
  margin: 0 0 6px 0;
}

.delete-text p {
  font-size: 14px;
  color: #6c757d;
  margin: 0;
  line-height: 1.6;
}

.delete-member-name {
  font-weight: 600;
  color: #2c3e50;
}

/* Footer buttons */
.delete-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.btn-modal {
  border: none;
  border-radius: 8px;
  padding: 10px 18px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.3s ease;
}

.btn-cancel {
  background: #ecf0f1;
  color: #2c3e50;
}

.btn-cancel:hover {
  background: #dcdfe1;
}

.btn-confirm-delete {
  background: #e74c3c;
  color: #fff;
}

.btn-confirm-delete:hover {
  background: #c0392b;
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    transform: translateY(40px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

</style>


<script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>

<script>
let currentServiceId = null;
let offerCounter = 0;
let faqCounter = 0;
let descriptionEditor = null;

// Initialize CKEditor
function initCKEditor() {
    const descriptionField = document.getElementById('updateDescription');
    
    // First, destroy any existing editor
    if (descriptionEditor) {
        descriptionEditor.destroy().catch(error => {
            console.error('Error destroying previous CKEditor:', error);
        });
        descriptionEditor = null;
    }
    
    if (descriptionField) {
        // Remove required attribute to prevent browser validation issues
        descriptionField.removeAttribute('required');
        
        // Make sure the textarea is visible for CKEditor
        descriptionField.style.display = 'block';
        descriptionField.style.visibility = 'visible';
        
        ClassicEditor
            .create(descriptionField, {
                toolbar: [
                    'heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList',
                    '|', 'insertTable', 'blockQuote', 'undo', 'redo'
                ],
                // Add these configurations for better modal integration
                ui: {
                    viewportOffset: { top: 50 }
                }
            })
            .then(editor => {
                descriptionEditor = editor;
                console.log('CKEditor initialized successfully');
                
                // Force the editor to update its UI
                setTimeout(() => {
                    editor.ui.view.element.style.display = 'block';
                    editor.ui.view.element.style.visibility = 'visible';
                }, 100);
            })
            .catch(error => {
                console.error('CKEditor initialization error:', error);
                // Fallback: ensure textarea is usable
                descriptionField.style.display = 'block';
                descriptionField.style.visibility = 'visible';
            });
    }
}

// Destroy CKEditor when modal closes
function destroyCKEditor() {
    if (descriptionEditor) {
        descriptionEditor.destroy().then(() => {
            descriptionEditor = null;
            console.log('CKEditor destroyed successfully');
        }).catch(error => {
            console.error('Error destroying CKEditor:', error);
        });
    }
}

// Escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text || '';
    return div.innerHTML;
}

// Show Alert
function showAlert(message, type = 'success') {
    const alert = document.getElementById('alertMessage');
    alert.textContent = message;
    alert.className = `alert-message alert-${type}`;
    alert.style.display = 'block';
    setTimeout(() => alert.style.display = 'none', 5000);
}

// Tab functionality
function initTabs() {
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(btn.dataset.tab).classList.add('active');
        });
    });
}

// Character count helper
function updateCharCount(inputId, counterId, max) {
    const input = document.getElementById(inputId);
    const counter = document.getElementById(counterId);
    if (input && counter) {
        const count = input.value.length;
        counter.textContent = `${count}/${max}`;
        counter.classList.remove('warning', 'error');
        if (count > max) {
            counter.classList.add('error');
        } else if (count > max - 20) {
            counter.classList.add('warning');
        }
    }
}

// Add Offer
function addOffer(data = {}) {
    offerCounter++;
    const html = `
        <div class="formset-item" id="offer-${offerCounter}">
            <div class="formset-header">
                <div class="formset-title">
                    <span class="formset-number">${offerCounter}</span>
                    Offer ${offerCounter}
                </div>
                <button type="button" class="btn-remove-formset" onclick="removeOffer(${offerCounter})">
                    <i class="mdi mdi-delete"></i> Remove
                </button>
            </div>
            <input type="hidden" name="offers-${offerCounter}-id" value="${data.id || ''}">
            <input type="hidden" name="offers-${offerCounter}-DELETE" value="">
            <div class="form-group">
                <label class="form-label">Title<span class="required">*</span></label>
                <input type="text" class="form-control" name="offers-${offerCounter}-title" value="${escapeHtml(data.title || '')}" required>
            </div>
            <div class="form-group">
                <label class="form-label">Description<span class="required">*</span></label>
                <textarea class="form-control" name="offers-${offerCounter}-description" rows="3" required>${escapeHtml(data.description || '')}</textarea>
            </div>
        </div>
    `;
    document.getElementById('offerFormset').insertAdjacentHTML('beforeend', html);
}

// Remove Offer
function removeOffer(id) {
    const item = document.getElementById(`offer-${id}`);
    const deleteInput = item.querySelector('input[name$="-DELETE"]');
    deleteInput.value = 'on';
    item.classList.add('marked-for-deletion');
    item.style.display = 'none';
}

// Add FAQ
function addFaq(data = {}) {
    const currentFaqs = document.querySelectorAll('#faqFormset .formset-item:not(.marked-for-deletion)').length;
    if (currentFaqs >= 10) {
        showAlert('Maximum 6 FAQs allowed', 'error');
        return;
    }
    
    faqCounter++;
    const html = `
        <div class="formset-item" id="faq-${faqCounter}">
            <div class="formset-header">
                <div class="formset-title">
                    <span class="formset-number">${faqCounter}</span>
                    FAQ ${faqCounter}
                </div>
                <button type="button" class="btn-remove-formset" onclick="removeFaq(${faqCounter})">
                    <i class="mdi mdi-delete"></i> Remove
                </button>
            </div>
            <input type="hidden" name="faqs-${faqCounter}-id" value="${data.id || ''}">
            <input type="hidden" name="faqs-${faqCounter}-DELETE" value="">
            <div class="form-group">
                <label class="form-label">Question<span class="required">*</span></label>
                <input type="text" class="form-control" name="faqs-${faqCounter}-question" value="${escapeHtml(data.question || '')}" required>
            </div>
            <div class="form-group">
                <label class="form-label">Answer<span class="required">*</span></label>
                <textarea class="form-control" name="faqs-${faqCounter}-answer" rows="4" required>${escapeHtml(data.answer || '')}</textarea>
            </div>
        </div>
    `;
    document.getElementById('faqFormset').insertAdjacentHTML('beforeend', html);
    
    const addBtn = document.getElementById('addFaqBtn');
    if (currentFaqs + 1 >= 10) {
        addBtn.style.display = 'none';
    }
}

// Remove FAQ
function removeFaq(id) {
    const item = document.getElementById(`faq-${id}`);
    const deleteInput = item.querySelector('input[name$="-DELETE"]');
    deleteInput.value = 'on';
    item.classList.add('marked-for-deletion');
    item.style.display = 'none';
    
    const currentFaqs = document.querySelectorAll('#faqFormset .formset-item:not(.marked-for-deletion)').length;
    const addBtn = document.getElementById('addFaqBtn');
    if (currentFaqs < 10) {
        addBtn.style.display = 'inline-flex';
    }
}

// Load Steps (Always 4)
function loadSteps(steps) {
    const container = document.getElementById('stepFormset');
    container.innerHTML = '';
    
    // Always create exactly 4 steps (numbered 1-4)
    for (let i = 1; i <= 4; i++) {
        const step = steps[i - 1] || {};
        const html = `
            <div class="formset-item">
                <div class="formset-header">
                    <div class="formset-title">
                        <span class="formset-number">${i}</span>
                        Step ${i}
                    </div>
                </div>
                <input type="hidden" name="steps-${i}-id" value="${step.id || ''}">
                <div class="form-group">
                    <label class="form-label">Step Title<span class="required">*</span></label>
                    <input type="text" class="form-control" name="steps-${i}-title" value="${escapeHtml(step.title || '')}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Tagline<span class="required">*</span></label>
                    <input type="text" class="form-control" name="steps-${i}-tagline" value="${escapeHtml(step.tagline || '')}" required>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
    }
}

// Open Update Modal
function openUpdateModal(serviceId) {
    currentServiceId = serviceId;
    
    // Reset counters
    offerCounter = 0;
    faqCounter = 0;
    document.getElementById('offerFormset').innerHTML = '';
    document.getElementById('faqFormset').innerHTML = '';
    document.getElementById('formErrors').style.display = 'none';
    
    // Load data
    fetch(`/api/service/${serviceId}/`)
        .then(res => {
            if (!res.ok) {
                throw new Error('Network response was not ok');
            }
            return res.json();
        })
        .then(data => {
            // Set basic fields first
            document.getElementById('updateName').value = data.name || '';
            
            // Set description value in textarea
            const descriptionField = document.getElementById('updateDescription');
            descriptionField.value = data.description || '';
            
            // Set meta fields
            document.getElementById('updateMetaTitle').value = data.meta_title || '';
            document.getElementById('updateMetaDescription').value = data.meta_description || '';
            
            // Update character counters
            updateCharCount('updateMetaTitle', 'metaTitleCount', 70);
            updateCharCount('updateMetaDescription', 'metaDescCount', 160);
            
            // Handle image
            const imageWrapper = document.getElementById('currentImageWrapper');
            const imageEl = document.getElementById('currentImage');
            if (data.image) {
                imageEl.src = data.image;
                imageWrapper.style.display = 'block';
            } else {
                imageWrapper.style.display = 'none';
            }
            
            // Load offers
            if (data.offers && Array.isArray(data.offers)) {
                data.offers.forEach(offer => addOffer(offer));
            }
            
            // Load steps (always 4)
            if (data.steps && Array.isArray(data.steps)) {
                loadSteps(data.steps);
            }
            
            // Load FAQs
            if (data.faqs && Array.isArray(data.faqs)) {
                data.faqs.forEach(faq => addFaq(faq));
            }
            
            // Update FAQ button visibility
            const addBtn = document.getElementById('addFaqBtn');
            if (data.faqs && data.faqs.length >= 6) {
                addBtn.style.display = 'none';
            } else {
                addBtn.style.display = 'inline-flex';
            }
            
            // Initialize tabs
            initTabs();
            
            // Show modal first
            document.getElementById('updateModal').classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Initialize CKEditor AFTER modal is shown and content is loaded
            setTimeout(() => {
                initCKEditor();
            }, 100);
        })
        .catch(err => {
            console.error('Error loading service data:', err);
            showAlert('Error loading service data', 'error');
        });
}

// Close Update Modal
function closeUpdateModal() {
    destroyCKEditor();
    document.getElementById('updateModal').classList.remove('show');
    document.body.style.overflow = 'auto';
    document.getElementById('imageInput').value = '';
}

// Submit Form
document.getElementById('updateForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate CKEditor content
    if (descriptionEditor) {
        const descriptionContent = descriptionEditor.getData().trim();
        if (!descriptionContent) {
            showAlert('Please fill in the description field', 'error');
            // Focus on the editor
            descriptionEditor.editing.view.focus();
            return false;
        }
        // Update the hidden textarea with CKEditor content
        document.getElementById('updateDescription').value = descriptionContent;
    } else {
        // Fallback validation for textarea
        const descriptionContent = document.getElementById('updateDescription').value.trim();
        if (!descriptionContent) {
            showAlert('Please fill in the description field', 'error');
            document.getElementById('updateDescription').focus();
            return false;
        }
    }
    
    const formData = new FormData(this);
    formData.set('offers-TOTAL_FORMS', offerCounter);
    formData.set('steps-TOTAL_FORMS', '4');
    formData.set('faqs-TOTAL_FORMS', faqCounter);
    
    // Show loading state
    const submitBtn = this.querySelector('.btn-submit');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="mdi mdi-loading mdi-spin"></i> Updating...';
    submitBtn.disabled = true;
    
    fetch(`/edit/${currentServiceId}/`, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
           
            closeUpdateModal();
            // Reload after a short delay to show the success message
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            document.getElementById('formErrors').textContent = data.message || 'An error occurred';
            document.getElementById('formErrors').style.display = 'block';
            // Reset button
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    })
    .catch(err => {
        console.error('Error updating service:', err);
        showAlert('Error updating service', 'error');
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});

// Delete Modal functions
function openDeleteModal(id, name) {
    document.getElementById('deleteForm').action = `/delete/${id}/`;
    document.getElementById('deleteServiceName').textContent = name;
    document.getElementById('deleteModal').classList.add('show');
    document.body.style.overflow = 'hidden';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('show');
    document.body.style.overflow = 'auto';
}

// Close modals on outside click
window.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal')) {
        if (e.target.id === 'updateModal') {
            closeUpdateModal();
        } else {
            e.target.classList.remove('show');
            document.body.style.overflow = 'auto';
        }
    }
});

// Add event listeners for real-time character counting
document.addEventListener('DOMContentLoaded', function() {
    const metaTitle = document.getElementById('updateMetaTitle');
    const metaDesc = document.getElementById('updateMetaDescription');
    
    if (metaTitle) {
        metaTitle.addEventListener('input', () => updateCharCount('updateMetaTitle', 'metaTitleCount', 70));
        // Initialize counter on page load
        updateCharCount('updateMetaTitle', 'metaTitleCount', 70);
    }
    if (metaDesc) {
        metaDesc.addEventListener('input', () => updateCharCount('updateMetaDescription', 'metaDescCount', 160));
        // Initialize counter on page load
        updateCharCount('updateMetaDescription', 'metaDescCount', 160);
    }
});
</script>



{% endblock %}